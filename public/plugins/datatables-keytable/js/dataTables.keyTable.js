/* KeyTable 2.5.1
 * Â©2009-2019 SpryMedia Ltd - datatables.net/license
 */
(function(a){if(typeof define==="function"&&define.amd){define(["jquery","datatables.net"],function(b){return a(b,window,document)})}else{if(typeof exports==="object"){module.exports=function(c,b){if(!c){c=window}if(!b||!b.fn.dataTable){b=require("datatables.net")(c,b).$}return a(b,c,c.document)}}else{a(jQuery,window,document)}}}(function(a,g,c,f){var b=a.fn.dataTable;var e=0;var d=function(h,j){if(!b.versionCheck||!b.versionCheck("1.10.8")){throw"KeyTable requires DataTables 1.10.8 or newer"}this.c=a.extend(true,{},b.defaults.keyTable,d.defaults,j);this.s={dt:new b.Api(h),enable:true,focusDraw:false,waitingForDraw:false,lastFocus:null,namespace:".keyTable-"+(e++)};this.dom={};var k=this.s.dt.settings()[0];var i=k.keytable;if(i){return i}k.keytable=this;this._constructor()};a.extend(d.prototype,{blur:function(){this._blur()},enable:function(h){this.s.enable=h},focus:function(i,h){this._focus(this.s.dt.cell(i,h))},focused:function(h){var i=this.s.lastFocus;if(!i){return false}var j=this.s.lastFocus.cell.index();return h.row===j.row&&h.column===j.column},_constructor:function(){this._tabInput();var n=this;var h=this.s.dt;var m=a(h.table().node());var k=this.s.namespace;var j=false;if(m.css("position")==="static"){m.css("position","relative")}a(h.table().body()).on("click"+k,"th, td",function(p){if(n.s.enable===false){return}var o=h.cell(this);if(!o.any()){return}n._focus(o,null,false,p)});a(c).on("keydown"+k,function(o){if(!j){n._key(o)}});if(this.c.blurable){a(c).on("mousedown"+k,function(o){if(a(o.target).parents(".dataTables_filter").length){n._blur()}if(a(o.target).parents().filter(h.table().container()).length){return}if(a(o.target).parents("div.DTE").length){return}if(a(o.target).parents("div.editor-datetime").length){return}if(a(o.target).parents().filter(".DTFC_Cloned").length){return}n._blur()})}if(this.c.editor){var i=this.c.editor;i.on("open.keyTableMain",function(p,q,o){if(q!=="inline"&&n.s.enable){n.enable(false);i.one("close"+k,function(){n.enable(true)})}});if(this.c.editOnFocus){h.on("key-focus"+k+" key-refocus"+k,function(q,p,o,r){n._editor(null,r,true)})}h.on("key"+k,function(q,p,r,o,s){n._editor(r,s,false)});a(h.table().body()).on("dblclick"+k,"th, td",function(p){if(n.s.enable===false){return}var o=h.cell(this);if(!o.any()){return}n._editor(null,p,true)});i.on("preSubmit",function(){j=true}).on("preSubmitCancelled",function(){j=false}).on("submitComplete",function(){j=false})}if(h.settings()[0].oFeatures.bStateSave){h.on("stateSaveParams"+k,function(p,q,o){o.keyTable=n.s.lastFocus?n.s.lastFocus.cell.index():null})}h.on("draw"+k,function(o){if(n.s.focusDraw){return}var q=n.s.lastFocus;if(q&&q.node&&a(q.node).closest("body")===c.body){var r=n.s.lastFocus.relative;var p=h.page.info();var s=r.row+p.start;if(p.recordsDisplay===0){return}if(s>=p.recordsDisplay){s=p.recordsDisplay-1}n._focus(s,r.column,true,o)}});if(this.c.clipboard){this._clipboard()}h.on("destroy"+k,function(){n._blur(true);h.off(k);a(h.table().body()).off("click"+k,"th, td").off("dblclick"+k,"th, td");a(c).off("mousedown"+k).off("keydown"+k).off("copy"+k).off("paste"+k)});var l=h.state.loaded();if(l&&l.keyTable){h.one("init",function(){var o=h.cell(l.keyTable);if(o.any()){o.focus()}})}else{if(this.c.focus){h.cell(this.c.focus).focus()}}},_blur:function(i){if(!this.s.enable||!this.s.lastFocus){return}var h=this.s.lastFocus.cell;a(h.node()).removeClass(this.c.className);this.s.lastFocus=null;if(!i){this._updateFixedColumns(h.index().column);this._emitEvent("key-blur",[this.s.dt,h])}},_clipboard:function(){var h=this.s.dt;var j=this;var i=this.s.namespace;if(!g.getSelection){return}a(c).on("copy"+i,function(l){var k=l.originalEvent;var n=g.getSelection().toString();var m=j.s.lastFocus;if(!n&&m){k.clipboardData.setData("text/plain",m.cell.render(j.c.clipboardOrthogonal));k.preventDefault()}});a(c).on("paste"+i,function(n){var l=n.originalEvent;var o=j.s.lastFocus;var k=c.activeElement;var m=j.c.editor;var p;if(o&&(!k||k.nodeName.toLowerCase()==="body")){l.preventDefault();if(g.clipboardData&&g.clipboardData.getData){p=g.clipboardData.getData("Text")}else{if(l.clipboardData&&l.clipboardData.getData){p=l.clipboardData.getData("text/plain")}}if(m){m.inline(o.cell.index()).set(m.displayed()[0],p).submit()}else{o.cell.data(p);h.draw(false)}}})},_columns:function(){var h=this.s.dt;var j=h.columns(this.c.columns).indexes();var i=[];h.columns(":visible").every(function(k){if(j.indexOf(k)!==-1){i.push(k)}});return i},_editor:function(m,o,l){var p=this;var h=this.s.dt;var k=this.c.editor;var i=this.s.lastFocus.cell;var n=this.s.namespace;if(a("div.DTE",i.node()).length){return}if(m!==null&&((m>=0&&m<=9)||m===11||m===12||(m>=14&&m<=31)||(m>=112&&m<=123)||(m>=127&&m<=159))){return}o.stopPropagation();if(m===13){o.preventDefault()}var j=function(){k.one("open"+n,function(){k.off("cancelOpen"+n);if(!l){a("div.DTE_Field_InputControl input, div.DTE_Field_InputControl textarea").select()}h.keys.enable(l?"tab-only":"navigation-only");h.on("key-blur.editor",function(s,r,q){if(k.displayed()&&q.node()===i.node()){k.submit()}});if(l){a(h.table().container()).addClass("dtk-focus-alt")}k.on("preSubmitCancelled"+n,function(){setTimeout(function(){p._focus(i,null,false)},50)});k.on("submitUnsuccessful"+n,function(){p._focus(i,null,false)});k.one("close",function(){h.keys.enable(true);h.off("key-blur.editor");k.off(n);a(h.table().container()).removeClass("dtk-focus-alt")})}).one("cancelOpen"+n,function(){k.off(n)}).inline(i.index())};if(m===13){l=true;a(c).one("keyup",function(){j()})}else{j()}},_emitEvent:function(i,h){this.s.dt.iterator("table",function(j,k){a(j.nTable).triggerHandler(i,h)})},_focus:function(s,k,t,p){var u=this;var l=this.s.dt;var q=l.page.info();var n=this.s.lastFocus;if(!p){p=null}if(!this.s.enable){return}if(typeof s!=="number"){if(!s.any()){return}var m=s.index();k=m.column;s=l.rows({filter:"applied",order:"applied"}).indexes().indexOf(m.row);if(s<0){return}if(q.serverSide){s+=q.start}}if(q.length!==-1&&(s<q.start||s>=q.start+q.length)){this.s.focusDraw=true;this.s.waitingForDraw=true;l.one("draw",function(){u.s.focusDraw=false;u.s.waitingForDraw=false;u._focus(s,k,f,p)}).page(Math.floor(s/q.length)).draw(false);return}if(a.inArray(k,this._columns())===-1){return}if(q.serverSide){s-=q.start}var j=l.cells(null,k,{search:"applied",order:"applied"}).flatten();var i=l.cell(j[s]);if(n){if(n.node===i.node()){this._emitEvent("key-refocus",[this.s.dt,i,p||null]);return}this._blur()}this._removeOtherFocus();var o=a(i.node());o.addClass(this.c.className);this._updateFixedColumns(k);if(t===f||t===true){this._scroll(a(g),a(c.body),o,"offset");var h=l.table().body().parentNode;if(h!==l.table().header().parentNode){var r=a(h.parentNode);this._scroll(r,r,o,"position")}}this.s.lastFocus={cell:i,node:i.node(),relative:{row:l.rows({page:"current"}).indexes().indexOf(i.index().row),column:i.index().column}};this._emitEvent("key-focus",[this.s.dt,i,p||null]);l.state.save()},_key:function(j){if(this.s.waitingForDraw){j.preventDefault();return}var k=this.s.enable;var n=k===true||k==="navigation-only";if(!k){return}if((j.keyCode===0||j.ctrlKey||j.metaKey||j.altKey)&&!(j.ctrlKey&&j.altKey)){return}var m=this.s.lastFocus;if(!m){return}if(!this.s.dt.cell(m.node).any()){this.s.lastFocus=null;return}var p=this;var i=this.s.dt;var o=this.s.dt.settings()[0].oScroll.sY?true:false;if(this.c.keys&&a.inArray(j.keyCode,this.c.keys)===-1){return}switch(j.keyCode){case 9:this._shift(j,j.shiftKey?"left":"right",true);break;case 27:if(this.s.blurable&&k===true){this._blur()}break;case 33:case 34:if(n&&!o){j.preventDefault();i.page(j.keyCode===33?"previous":"next").draw(false)}break;case 35:case 36:if(n){j.preventDefault();var l=i.cells({page:"current"}).indexes();var h=this._columns();this._focus(i.cell(l[j.keyCode===35?l.length-1:h[0]]),null,true,j)}break;case 37:if(n){this._shift(j,"left")}break;case 38:if(n){this._shift(j,"up")}break;case 39:if(n){this._shift(j,"right")}break;case 40:if(n){this._shift(j,"down")}break;case 113:if(this.c.editor){this._editor(null,j,true);break}default:if(k===true){this._emitEvent("key",[i,j.keyCode,this.s.lastFocus.cell,j])}break}},_removeOtherFocus:function(){var h=this.s.dt.table().node();a.fn.dataTable.tables({api:true}).iterator("table",function(i){if(this.table().node()!==h){this.cell.blur()}})},_scroll:function(i,o,h,n){var m=h[n]();var l=h.outerHeight();var r=h.outerWidth();var q=o.scrollTop();var p=o.scrollLeft();var j=i.height();var k=i.width();if(n==="position"){m.top+=parseInt(h.closest("table").css("top"),10)}if(m.top<q){o.scrollTop(m.top)}if(m.left<p){o.scrollLeft(m.left)}if(m.top+l>q+j&&l<j){o.scrollTop(m.top+l-j)}if(m.left+r>p+k&&r<k){o.scrollLeft(m.left+r-k)}},_shift:function(o,m,p){var t=this;var n=this.s.dt;var q=n.page.info();var s=q.recordsDisplay;var k=this.s.lastFocus.cell;var i=this._columns();if(!k){return}var l=n.rows({filter:"applied",order:"applied"}).indexes().indexOf(k.index().row);if(q.serverSide){l+=q.start}var j=n.columns(i).indexes().indexOf(k.index().column);var r=l,h=i[j];if(m==="right"){if(j>=i.length-1){r++;h=i[0]}else{h=i[j+1]}}else{if(m==="left"){if(j===0){r--;h=i[i.length-1]}else{h=i[j-1]}}else{if(m==="up"){r--}else{if(m==="down"){r++}}}}if(r>=0&&r<s&&a.inArray(h,i)!==-1){if(o){o.preventDefault()}this._focus(r,h,true,o)}else{if(!p||!this.c.blurable){if(o){o.preventDefault()}}else{this._blur()}}},_tabInput:function(){var k=this;var i=this.s.dt;var j=this.c.tabIndex!==null?this.c.tabIndex:i.settings()[0].iTabIndex;if(j==-1){return}var h=a('<div><input type="text" tabindex="'+j+'"/></div>').css({position:"absolute",height:1,width:0,overflow:"hidden"}).insertBefore(i.table().node());h.children().on("focus",function(m){var l=i.cell(":eq(0)",k._columns(),{page:"current"});if(l.any()){k._focus(l,null,true,m)}})},_updateFixedColumns:function(h){var i=this.s.dt;var l=i.settings()[0];if(l._oFixedColumns){var j=l._oFixedColumns.s.iLeftColumns;var k=l.aoColumns.length-l._oFixedColumns.s.iRightColumns;if(h<j||h>=k){i.fixedColumns().update()}}}});d.defaults={blurable:true,className:"focus",clipboard:true,clipboardOrthogonal:"display",columns:"",editor:null,editOnFocus:false,focus:null,keys:null,tabIndex:null};d.version="2.5.1";a.fn.dataTable.KeyTable=d;a.fn.DataTable.KeyTable=d;b.Api.register("cell.blur()",function(){return this.iterator("table",function(h){if(h.keytable){h.keytable.blur()}})});b.Api.register("cell().focus()",function(){return this.iterator("cell",function(i,j,h){if(i.keytable){i.keytable.focus(j,h)}})});b.Api.register("keys.disable()",function(){return this.iterator("table",function(h){if(h.keytable){h.keytable.enable(false)}})});b.Api.register("keys.enable()",function(h){return this.iterator("table",function(i){if(i.keytable){i.keytable.enable(h===f?true:h)}})});b.Api.register("keys.move()",function(h){return this.iterator("table",function(i){if(i.keytable){i.keytable._shift(null,h,false)}})});b.ext.selector.cell.push(function(p,n,h){var j=n.focused;var m=p.keytable;var o=[];if(!m||j===f){return h}for(var k=0,l=h.length;k<l;k++){if((j===true&&m.focused(h[k]))||(j===false&&!m.focused(h[k]))){o.push(h[k])}}return o});a(c).on("preInit.dt.dtk",function(i,m,k){if(i.namespace!=="dt"){return}var j=m.oInit.keys;var h=b.defaults.keys;if(j||h){var l=a.extend({},h,j);if(j!==false){new d(m,l)}}});return d}));